<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bingo Spinner</title>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
    }

    .container {
      width: 95%;
      max-width: 1600px;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 30px;
      padding: 30px;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .spinner-section {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 24px;
      padding: 50px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .spinner-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(126, 34, 206, 0.05) 0%, transparent 70%);
      animation: pulse 8s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50% { transform: scale(1.1); opacity: 0.5; }
    }

    .title {
      font-family: 'Bebas Neue', cursive;
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 30px;
      text-align: center;
      letter-spacing: 3px;
      position: relative;
      z-index: 1;
    }

    .spinner-container {
      position: relative;
      width: 550px;
      height: 550px;
      margin-bottom: 40px;
      z-index: 1;
    }

    .spinner-pointer {
      position: absolute;
      top: -35px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-top: 45px solid #dc2626;
      z-index: 10;
      filter: drop-shadow(0 4px 8px rgba(220, 38, 38, 0.5));
      animation: pointerBounce 2s ease-in-out infinite;
    }

    @keyframes pointerBounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-5px); }
    }

    .spinner-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 50%;
      border: 5px solid #1f2937;
      z-index: 5;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .spin-button {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
      border: none;
      padding: 20px 60px;
      font-size: 26px;
      font-weight: 700;
      border-radius: 60px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      z-index: 1;
      font-family: 'Bebas Neue', cursive;
    }

    .spin-button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(220, 38, 38, 0.5);
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .spin-button:active:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
    }

    .spin-button:disabled {
      background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .result {
      margin-top: 30px;
      font-size: 28px;
      font-weight: 700;
      color: #dc2626;
      text-align: center;
      min-height: 40px;
      position: relative;
      z-index: 1;
      animation: resultFadeIn 0.5s ease-out;
    }

    @keyframes resultFadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .word-list-section {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      max-height: 800px;
    }

    .word-list-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }

    .word-list-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
    }

    .word-count {
      font-size: 13px;
      color: #6b7280;
      margin-top: 4px;
      font-weight: 500;
    }

    .clear-all-button {
      background: #dc2626;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .clear-all-button:hover:not(:disabled) {
      background: #b91c1c;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    .clear-all-button:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .word-input-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .word-input {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
      outline: none;
    }

    .word-input:focus {
      border-color: #7e22ce;
      box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
    }

    .word-input:disabled {
      background: #f3f4f6;
      cursor: not-allowed;
    }

    .add-button {
      background: linear-gradient(135deg, #7e22ce 0%, #5b21b6 100%);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .add-button:hover:not(:disabled) {
      background: linear-gradient(135deg, #6b21a8 0%, #4c1d95 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(126, 34, 206, 0.3);
    }

    .add-button:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .words-container {
      flex: 1;
      overflow-y: auto;
      max-height: 500px;
      padding-right: 8px;
    }

    .words-container::-webkit-scrollbar {
      width: 8px;
    }

    .words-container::-webkit-scrollbar-track {
      background: #f3f4f6;
      border-radius: 10px;
    }

    .words-container::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 10px;
    }

    .words-container::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }

    .word-item {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      padding: 14px 18px;
      margin-bottom: 10px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border: 1px solid #e5e7eb;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .word-item:hover {
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .word-text {
      font-size: 16px;
      color: #1f2937;
      font-weight: 500;
    }

    .remove-button {
      background: #ef4444;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .remove-button:hover {
      background: #dc2626;
      transform: scale(1.05);
    }

    .sound-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #e5e7eb;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 10;
      font-size: 24px;
    }

    .sound-toggle:hover {
      background: white;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .eliminated-section {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      max-height: 800px;
    }

    .eliminated-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }

    .eliminated-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
    }

    .eliminated-count {
      font-size: 13px;
      color: #6b7280;
      margin-top: 4px;
      font-weight: 500;
    }

    .clear-eliminated-button {
      background: #7c3aed;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .clear-eliminated-button:hover:not(:disabled) {
      background: #6d28d9;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }

    .clear-eliminated-button:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .eliminated-container {
      flex: 1;
      overflow-y: auto;
      max-height: 680px;
      padding-right: 8px;
    }

    .eliminated-container::-webkit-scrollbar {
      width: 8px;
    }

    .eliminated-container::-webkit-scrollbar-track {
      background: #f3f4f6;
      border-radius: 10px;
    }

    .eliminated-container::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 10px;
    }

    .eliminated-container::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }

    .eliminated-item {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: 14px 18px;
      margin-bottom: 10px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border: 1px solid #fbbf24;
      animation: slideIn 0.3s ease-out;
      position: relative;
      overflow: hidden;
    }

    .eliminated-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
    }

    .eliminated-item:hover {
      background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
    }

    .eliminated-text {
      font-size: 16px;
      color: #78350f;
      font-weight: 600;
      padding-left: 12px;
    }

    .eliminated-order {
      background: #f59e0b;
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      min-width: 40px;
      text-align: center;
    }

    .final-winner-item {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border: 2px solid #10b981;
      position: relative;
    }

    .final-winner-item::before {
      background: linear-gradient(180deg, #10b981 0%, #059669 100%);
    }

    .final-winner-item .eliminated-text {
      color: #064e3b;
    }

    .final-winner-item .eliminated-order {
      background: #10b981;
    }

    .winner-badge {
      background: #10b981;
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      margin-left: 8px;
    }

    .empty-eliminated {
      text-align: center;
      padding: 40px 20px;
      color: #9ca3af;
      font-size: 14px;
    }

    .empty-eliminated-icon {
      font-size: 48px;
      margin-bottom: 10px;
      opacity: 0.5;
    }

    @media (max-width: 1400px) {
      .eliminated-section {
        display: none;
      }
      .show-eliminated-mobile {
        display: block;
        margin-top: 20px;
      }
    }

    @media (max-width: 1400px) {
      .container {
        grid-template-columns: 2fr 1fr;
      }
      .eliminated-section {
        display: none;
      }
    }

    @media (max-width: 1200px) {
      .container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      .eliminated-section {
        display: flex;
      }
      .spinner-container {
        width: 450px;
        height: 450px;
      }
    }

    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      .spinner-container {
        width: 350px;
        height: 350px;
      }
      .title {
        font-size: 36px;
      }
      .spin-button {
        padding: 16px 40px;
        font-size: 22px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
  <div class="container">
    <div class="spinner-section">
      <button class="sound-toggle" id="soundToggle" title="Toggle sound">üîä</button>
      <div class="title" id="title">Bingo Spinner</div>
      <div class="spinner-container">
        <div class="spinner-pointer"></div>
        <canvas id="spinnerCanvas" width="550" height="550"></canvas>
        <div class="spinner-center"></div>
      </div>
      <button class="spin-button" id="spinButton">Zavrti!</button>
      <div class="result" id="result"></div>
    </div>
    <div class="word-list-section">
      <div class="word-list-header">
        <div>
          <div class="word-list-title">Seznam besed</div>
          <div class="word-count" id="wordCount">0 / 50 besed</div>
        </div>
        <button class="clear-all-button" id="clearAllButton">Izbri≈°i vse</button>
      </div>
      <div class="word-input-container">
        <input type="text" class="word-input" id="wordInput" placeholder="Vnesi besedo">
        <button class="add-button" id="addButton">Dodaj</button>
      </div>
      <div class="words-container" id="wordsContainer"></div>
    </div>
    <div class="eliminated-section">
      <div class="eliminated-header">
        <div>
          <div class="eliminated-title">Odstranjeni</div>
          <div class="eliminated-count" id="eliminatedCount">0 odstranjenih</div>
        </div>
        <button class="clear-eliminated-button" id="clearEliminatedButton">Poƒçisti</button>
      </div>
      <div class="eliminated-container" id="eliminatedContainer">
        <div class="empty-eliminated">
          <div class="empty-eliminated-icon">üéØ</div>
          <div>Odstranjeni elementi se bodo prikazali tukaj</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      DEFAULT: {
        title_text: "BINGO",
        result_prefix: "ZMAGOVALEC:",
        max_words: 50
      }
    };

    // State
    const state = {
      config: {},
      words: ["Jabolko", "Banana", "ƒåe≈°nja", "Datlji", "Bezeg", "Figa", "Grozdje", "Melona"],
      eliminatedWords: [],
      isSpinning: false,
      currentRotation: 0,
      soundEnabled: true,
      audioContext: null
    };

    // Constants
    const MAX_WORDS = 50;
    const CANVAS_SIZE = 550;
    const CANVAS_CENTER = CANVAS_SIZE / 2;
    const SPINNER_RADIUS = CANVAS_CENTER;
    const SPIN_DURATION = 4000;
    const BASE_ROTATIONS = 5;
    const COLORS = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', 
      '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', 
      '#F06292', '#AED581', '#FF8A65', '#64B5F6'
    ];

    // DOM Elements
    const elements = {
      canvas: document.getElementById('spinnerCanvas'),
      ctx: document.getElementById('spinnerCanvas').getContext('2d'),
      spinButton: document.getElementById('spinButton'),
      wordInput: document.getElementById('wordInput'),
      addButton: document.getElementById('addButton'),
      clearAllButton: document.getElementById('clearAllButton'),
      wordsContainer: document.getElementById('wordsContainer'),
      resultDiv: document.getElementById('result'),
      wordCountDiv: document.getElementById('wordCount'),
      soundToggle: document.getElementById('soundToggle'),
      title: document.getElementById('title'),
      eliminatedContainer: document.getElementById('eliminatedContainer'),
      eliminatedCountDiv: document.getElementById('eliminatedCount'),
      clearEliminatedButton: document.getElementById('clearEliminatedButton')
    };

    // ============================================================================
    // Audio System - Much Improved!
    // ============================================================================
    
    class AudioSystem {
      constructor() {
        this.context = null;
        this.tickCount = 0;
      }

      init() {
        if (!this.context) {
          this.context = new (window.AudioContext || window.webkitAudioContext)();
        }
        return this.context;
      }

      // Gentle, pleasant tick sound - much less irritating!
      playTick(speed = 1) {
        if (!state.soundEnabled || !this.context) return;

        const audioContext = this.context;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        // Use a sine wave for a softer, more pleasant sound
        oscillator.type = 'sine';
        
        // Lower frequency for a subtle, gentle click
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        
        // Quick fade out for a crisp but not harsh sound
        gainNode.gain.setValueAtTime(0.08 * speed, audioContext.currentTime); // Much quieter
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.05);
        
        this.tickCount++;
      }

      // Victory fanfare - celebratory but not obnoxious
      playVictorySound() {
        if (!state.soundEnabled || !this.context) return;

        const audioContext = this.context;
        const times = [0, 0.15, 0.3];
        const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5 - major chord

        times.forEach((time, index) => {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.type = 'sine';
          oscillator.frequency.setValueAtTime(frequencies[index], audioContext.currentTime + time);
          
          gainNode.gain.setValueAtTime(0, audioContext.currentTime + time);
          gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + time + 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + time + 0.5);
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.start(audioContext.currentTime + time);
          oscillator.stop(audioContext.currentTime + time + 0.5);
        });
      }

      toggleSound() {
        state.soundEnabled = !state.soundEnabled;
        elements.soundToggle.textContent = state.soundEnabled ? 'üîä' : 'üîá';
        return state.soundEnabled;
      }
    }

    const audioSystem = new AudioSystem();

    // ============================================================================
    // Canvas Drawing
    // ============================================================================
    
    function drawSpinner() {
      const { ctx } = elements;
      const { words, currentRotation } = state;

      if (words.length === 0) {
        ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
        ctx.fillStyle = '#f3f4f6';
        ctx.beginPath();
        ctx.arc(CANVAS_CENTER, CANVAS_CENTER, SPINNER_RADIUS, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#9ca3af';
        ctx.font = 'bold 20px Poppins';
        ctx.textAlign = 'center';
        ctx.fillText('Dodaj besede za vrtenje!', CANVAS_CENTER, CANVAS_CENTER);
        return;
      }

      const sliceAngle = (Math.PI * 2) / words.length;
      ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

      // Draw slices
      for (let i = 0; i < words.length; i++) {
        const startAngle = i * sliceAngle + currentRotation;
        const endAngle = (i + 1) * sliceAngle + currentRotation;
        
        // Fill slice
        ctx.fillStyle = COLORS[i % COLORS.length];
        ctx.beginPath();
        ctx.moveTo(CANVAS_CENTER, CANVAS_CENTER);
        ctx.arc(CANVAS_CENTER, CANVAS_CENTER, SPINNER_RADIUS, startAngle, endAngle);
        ctx.closePath();
        ctx.fill();
        
        // Border
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // Add subtle inner shadow effect
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Draw text
        drawSliceText(i, startAngle, sliceAngle);
      }
    }

    function drawSliceText(index, startAngle, sliceAngle) {
      const { ctx } = elements;
      const { words } = state;
      
      ctx.save();
      ctx.translate(CANVAS_CENTER, CANVAS_CENTER);
      ctx.rotate(startAngle + sliceAngle / 2);
      ctx.textAlign = 'center';
      ctx.fillStyle = 'white';
      ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
      ctx.lineWidth = 3;
      
      // Dynamic font sizing
      let fontSize = 18;
      if (words.length > 20) fontSize = 14;
      else if (words.length > 30) fontSize = 12;
      if (words[index].length > 10) fontSize = Math.max(10, fontSize - 2);
      
      ctx.font = `bold ${fontSize}px Poppins`;
      
      const maxWidth = SPINNER_RADIUS * 0.45;
      const text = words[index];
      
      // Text wrapping for long words
      if (ctx.measureText(text).width > maxWidth && text.length > 8) {
        const midPoint = Math.floor(text.length / 2);
        const firstHalf = text.substring(0, midPoint);
        const secondHalf = text.substring(midPoint);
        
        ctx.strokeText(firstHalf, SPINNER_RADIUS * 0.65, -2);
        ctx.fillText(firstHalf, SPINNER_RADIUS * 0.65, -2);
        ctx.strokeText(secondHalf, SPINNER_RADIUS * 0.65, fontSize + 2);
        ctx.fillText(secondHalf, SPINNER_RADIUS * 0.65, fontSize + 2);
      } else {
        ctx.strokeText(text, SPINNER_RADIUS * 0.65, 6);
        ctx.fillText(text, SPINNER_RADIUS * 0.65, 6);
      }
      
      ctx.restore();
    }

    // ============================================================================
    // Spinner Animation
    // ============================================================================
    
    function spinWheel() {
      if (state.words.length === 0 || state.isSpinning) return;
      
      // Remove previously eliminated word
      handlePreviousElimination();
      
      if (state.words.length === 0) {
        elements.spinButton.disabled = true;
        return;
      }
      
      state.isSpinning = true;
      elements.spinButton.disabled = true;
      elements.resultDiv.textContent = '';
      drawSpinner();
      
      // Initialize audio
      audioSystem.init();
      
      const startRotation = state.currentRotation;
      const totalRotation = (BASE_ROTATIONS + Math.random() * 3) * Math.PI * 2;
      const startTime = Date.now();
      const sliceAngle = (Math.PI * 2) / state.words.length;
      
      let lastClickRotation = 0;
      
      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / SPIN_DURATION, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        
        state.currentRotation = startRotation + (easeOut * totalRotation);
        
        // Play tick sound at slice boundaries
        const rotationDiff = state.currentRotation - lastClickRotation;
        if (rotationDiff >= sliceAngle) {
          lastClickRotation = state.currentRotation;
          const speed = 1 - easeOut; // Slower ticks as it slows down
          audioSystem.playTick(speed);
        }
        
        drawSpinner();
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          selectWinner();
        }
      }
      
      animate();
    }

    function handlePreviousElimination() {
      const resultText = elements.resultDiv.textContent;
      if (!resultText) return;
      
      const prefix = state.config.result_prefix || CONFIG.DEFAULT.result_prefix;
      const previousWinner = resultText.replace(prefix, '').replace('üéâ', '').replace('KONƒåNI ZMAGOVALEC:', '').trim();
      const winnerIndex = state.words.findIndex(w => w.toUpperCase() === previousWinner);
      
      if (winnerIndex !== -1) {
        const eliminatedWord = state.words[winnerIndex];
        state.eliminatedWords.push({
          word: eliminatedWord,
          order: state.eliminatedWords.length + 1,
          isFinalWinner: false
        });
        state.words.splice(winnerIndex, 1);
        renderWordList();
        renderEliminatedList();
        updateWordCount();
      }
    }

    function selectWinner() {
      if (state.words.length === 0) {
        state.isSpinning = false;
        elements.spinButton.disabled = true;
        return;
      }
      
      const sliceAngle = (Math.PI * 2) / state.words.length;
      const normalizedRotation = ((state.currentRotation % (Math.PI * 2)) + (Math.PI * 2)) % (Math.PI * 2);
      const topAngle = (3 * Math.PI / 2);
      let relativeAngle = (topAngle - normalizedRotation);
      relativeAngle = ((relativeAngle % (Math.PI * 2)) + (Math.PI * 2)) % (Math.PI * 2);
      
      const selectedIndex = Math.floor(relativeAngle / sliceAngle) % state.words.length;
      const eliminated = state.words[selectedIndex];
      
      if (state.words.length === 2) {
        handleFinalWinner(selectedIndex, eliminated);
      } else {
        showElimination(eliminated);
      }
      
      state.isSpinning = false;
      elements.spinButton.disabled = false;
    }

    function handleFinalWinner(selectedIndex, eliminated) {
      // Add eliminated to list first
      state.eliminatedWords.push({
        word: eliminated,
        order: state.eliminatedWords.length + 1,
        isFinalWinner: false
      });
      
      state.words.splice(selectedIndex, 1);
      renderWordList();
      renderEliminatedList();
      updateWordCount();
      
      const finalWinner = state.words[0];
      const prefix = state.config.result_prefix || CONFIG.DEFAULT.result_prefix;
      
      // Show elimination first
      elements.resultDiv.textContent = `${prefix} ${eliminated.toUpperCase()}`;
      elements.resultDiv.style.fontSize = '28px';
      elements.resultDiv.style.color = '#dc2626';
      elements.resultDiv.style.textShadow = 'none';
      
      // Then show final winner
      setTimeout(() => {
        elements.resultDiv.textContent = `üéâ KONƒåNI ZMAGOVALEC: ${finalWinner.toUpperCase()} üéâ`;
        elements.resultDiv.style.fontSize = '32px';
        elements.resultDiv.style.color = '#fbbf24';
        elements.resultDiv.style.textShadow = '0 0 20px rgba(251, 191, 36, 0.8)';
        
        // Add final winner to eliminated list with special flag
        state.eliminatedWords.push({
          word: finalWinner,
          order: state.eliminatedWords.length + 1,
          isFinalWinner: true
        });
        
        audioSystem.playVictorySound();
        launchFireworks();
        
        state.words = [];
        renderWordList();
        renderEliminatedList();
        updateWordCount();
        drawSpinner();
        elements.spinButton.disabled = true;
      }, 2000);
    }

    function showElimination(eliminated) {
      const prefix = state.config.result_prefix || CONFIG.DEFAULT.result_prefix;
      elements.resultDiv.textContent = `${prefix} ${eliminated.toUpperCase()}`;
      elements.resultDiv.style.fontSize = '28px';
      elements.resultDiv.style.color = '#dc2626';
      elements.resultDiv.style.textShadow = 'none';
    }

    // ============================================================================
    // Fireworks Effect
    // ============================================================================
    
    function launchFireworks() {
      const container = document.createElement('div');
      container.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
      `;
      document.body.appendChild(container);
      
      const fireworkColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffa07a', '#f7dc6f', '#bb8fce', '#85c1e2'];
      
      for (let i = 0; i < 15; i++) {
        setTimeout(() => createFirework(container, fireworkColors), i * 200);
      }
      
      setTimeout(() => document.body.removeChild(container), 4000);
    }

    function createFirework(container, colors) {
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * (window.innerHeight * 0.6) + window.innerHeight * 0.1;
      const color = colors[Math.floor(Math.random() * colors.length)];
      
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.style.cssText = `
          position: absolute;
          left: ${x}px;
          top: ${y}px;
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background-color: ${color};
          box-shadow: 0 0 10px ${color};
        `;
        
        const angle = (Math.PI * 2 * i) / 30;
        const velocity = 100 + Math.random() * 100;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;
        
        container.appendChild(particle);
        animateParticle(particle, x, y, vx, vy, container);
      }
    }

    function animateParticle(particle, startX, startY, vx, vy, container) {
      let px = startX;
      let py = startY;
      const startTime = Date.now();
      
      function animate() {
        const elapsed = (Date.now() - startTime) / 1000;
        const life = Math.max(0, 1 - elapsed / 1.5);
        
        if (life > 0) {
          px += vx * 0.016;
          py += vy * 0.016 + 100 * elapsed;
          
          particle.style.left = px + 'px';
          particle.style.top = py + 'px';
          particle.style.opacity = life;
          particle.style.transform = `scale(${life})`;
          
          requestAnimationFrame(animate);
        } else {
          container.removeChild(particle);
        }
      }
      
      animate();
    }

    // ============================================================================
    // Word Management
    // ============================================================================
    
    function addWord() {
      const input = elements.wordInput.value.trim();
      const maxWords = state.config.max_words || MAX_WORDS;
      
      if (!input) return;
      
      const newWords = input.split(/\s+/).filter(w => w.length > 0);
      
      newWords.forEach(word => {
        if (state.words.length < maxWords) {
          state.words.push(word);
        }
      });
      
      elements.wordInput.value = '';
      renderWordList();
      drawSpinner();
      elements.spinButton.disabled = false;
      updateClearAllButton();
      updateWordCount();
    }

    function removeWord(index) {
      state.words.splice(index, 1);
      renderWordList();
      drawSpinner();
      elements.spinButton.disabled = state.words.length === 0 || state.isSpinning;
      updateClearAllButton();
      updateWordCount();
    }

    function clearAllWords() {
      state.words = [];
      state.eliminatedWords = [];
      elements.resultDiv.textContent = '';
      renderWordList();
      renderEliminatedList();
      drawSpinner();
      elements.spinButton.disabled = true;
      updateClearAllButton();
      updateWordCount();
    }

    function clearEliminatedWords() {
      state.eliminatedWords = [];
      renderEliminatedList();
    }

    function renderEliminatedList() {
      elements.eliminatedContainer.innerHTML = '';
      
      if (state.eliminatedWords.length === 0) {
        elements.eliminatedContainer.innerHTML = `
          <div class="empty-eliminated">
            <div class="empty-eliminated-icon">üéØ</div>
            <div>Odstranjeni elementi se bodo prikazali tukaj</div>
          </div>
        `;
        elements.clearEliminatedButton.disabled = true;
        elements.eliminatedCountDiv.textContent = '0 odstranjenih';
        return;
      }
      
      elements.clearEliminatedButton.disabled = false;
      elements.eliminatedCountDiv.textContent = `${state.eliminatedWords.length} odstranjenih`;
      
      // Reverse the array to show newest first
      const reversedWords = [...state.eliminatedWords].reverse();
      
      reversedWords.forEach((item, index) => {
        const eliminatedItem = document.createElement('div');
        eliminatedItem.className = item.isFinalWinner ? 'eliminated-item final-winner-item' : 'eliminated-item';
        
        const eliminatedText = document.createElement('span');
        eliminatedText.className = 'eliminated-text';
        eliminatedText.textContent = item.word;
        
        if (item.isFinalWinner) {
          const winnerBadge = document.createElement('span');
          winnerBadge.className = 'winner-badge';
          winnerBadge.textContent = 'üëë ZMAGOVALEC';
          eliminatedText.appendChild(winnerBadge);
        }
        
        const orderBadge = document.createElement('span');
        orderBadge.className = 'eliminated-order';
        orderBadge.textContent = `#${item.order}`;
        
        eliminatedItem.appendChild(eliminatedText);
        eliminatedItem.appendChild(orderBadge);
        elements.eliminatedContainer.appendChild(eliminatedItem);
      });
    }

    function renderWordList() {
      elements.wordsContainer.innerHTML = '';
      
      state.words.forEach((word, index) => {
        const wordItem = document.createElement('div');
        wordItem.className = 'word-item';
        
        const wordText = document.createElement('span');
        wordText.className = 'word-text';
        wordText.textContent = word;
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-button';
        removeBtn.textContent = 'Odstrani';
        removeBtn.onclick = () => removeWord(index);
        
        wordItem.appendChild(wordText);
        wordItem.appendChild(removeBtn);
        elements.wordsContainer.appendChild(wordItem);
      });
    }

    function updateWordCount() {
      const maxWords = state.config.max_words || MAX_WORDS;
      elements.wordCountDiv.textContent = `${state.words.length} / ${maxWords} besed`;
      
      if (state.words.length >= maxWords) {
        elements.addButton.disabled = true;
        elements.wordInput.disabled = true;
        elements.wordInput.placeholder = `Dose≈æena omejitev ${maxWords} besed`;
      } else {
        elements.addButton.disabled = false;
        elements.wordInput.disabled = false;
        elements.wordInput.placeholder = 'Vnesi besedo';
      }
    }

    function updateClearAllButton() {
      elements.clearAllButton.disabled = state.words.length === 0;
    }

    // ============================================================================
    // Configuration & Initialization
    // ============================================================================
    
    async function onConfigChange(newConfig) {
      state.config = newConfig;
      elements.title.textContent = state.config.title_text || CONFIG.DEFAULT.title_text;
      updateWordCount();
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["title_text", config.title_text || CONFIG.DEFAULT.title_text],
        ["result_prefix", config.result_prefix || CONFIG.DEFAULT.result_prefix],
        ["max_words", config.max_words || CONFIG.DEFAULT.max_words]
      ]);
    }

    // Event Listeners
    elements.spinButton.addEventListener('click', spinWheel);
    elements.addButton.addEventListener('click', addWord);
    elements.clearAllButton.addEventListener('click', clearAllWords);
    elements.clearEliminatedButton.addEventListener('click', clearEliminatedWords);
    elements.soundToggle.addEventListener('click', () => audioSystem.toggleSound());
    elements.wordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addWord();
    });

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: CONFIG.DEFAULT,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
      state.config = window.elementSdk.config;
    }

    // Initial render
    renderWordList();
    renderEliminatedList();
    drawSpinner();
    updateClearAllButton();
    updateWordCount();
  </script>
</body>
</html>
